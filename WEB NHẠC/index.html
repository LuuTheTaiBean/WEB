<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trang Web Âm Nhạc</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <a class="d-none" href="Audio/000017.mp3"></a>
    <header class="fixed-top py-1">
      <nav class="container navbar navbar-expand-lg">
        <div class="container-fluid">
          <a class="navbar-brand me-5" href="../index.html">
            <img src="../img/Logo.svg" alt="" />
          </a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#offcanvasMenu"
            aria-controls="offcanvasMenu"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse">
            <ul
              class="navbar-nav me-5 mb-2 mb-lg-0 d-flex justify-content-between w-100"
            >
              <!-- OFFICIAL AUDIO -->
              <audio id="audioPlayer"></audio>
              <li class="nav-item icon">
                <a class="nav-link active" href="#" onclick="toggleAudio()">
                  <i class="fa-solid fa-play" id="playIcon"></i>
                </a>
              </li>
              <!-- COVER AUDIO -->
              <li class="nav-item icon">
                <a class="nav-link" href="#">
                  <i class="fa-solid fa-microphone-lines"></i>
                </a>
              </li>
              <li class="nav-item icon">
                <a class="nav-link" href="#">
                  <i class="fa-solid fa-guitar"></i>
                </a>
              </li>
              <li class="nav-item icon">
                <a class="nav-link" href="#">
                  <i class="fa-solid fa-drum"></i>
                </a>
              </li>
              <li class="nav-item icon">
                <a class="nav-link" href="#">
                  <i class="fa-solid fa-file-audio"></i>
                </a>
              </li>
              <li class="nav-item icon">
                <a class="nav-link" href="#">
                  <i class="fa-solid fa-keyboard"></i>
                </a>
              </li>
            </ul>
            <!-- Thanh tìm kiếm -->
            <div class="search-container w-25 mx-auto">
              <i
                class="fa-solid fa-magnifying-glass text-primary me-2 fs-6 ms-1"
              ></i>
              <input
                type="text"
                id="searchInput"
                class="form-control border-0 bg-primary bg-opacity-75 rounded-pill py-1 px-2 fs-6"
                placeholder="Search for songs..."
                onkeyup="searchSong(event)"
              />
              <ul id="suggestionsList" class="suggestions p-2"></ul>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="py-5">
      <div class="container mt-4">
        <h2 class="text-center opacity-0">
          Danh sách bài hát (<span id="totalSongs">0</span>)
        </h2>
        <div class="row">
          <div class="col-lg-3 border-end d-none d-lg-block">
            <h4>List of Songs (<span id="totalSongsDisplay">0</span>)</h4>
            <ul id="artistSongList" class="list-group"></ul>
          </div>
          <div class="col-lg-6 border border-dark mb-3">
            <h2 class="text-danger text-center" id="songTitle"></h2>
            <h4 class="text-end" id="songArtist"></h4>
            <p class="text-wrap" id="songLyrics"></p>
          </div>
          <div class="col-lg-3 py-4">
            <p><strong>Number:</strong> <span id="songNumber"></span></p>
            <p><strong>Rating:</strong> <span id="songRating"></span></p>
            <p><strong>Year:</strong> <span id="songYear"></span></p>
            <p><strong>Link:</strong> <span id="songLink"></span></p>
            <p>
              <strong>Description:</strong> <span id="songDescription"></span>
            </p>
          </div>
        </div>
      </div>
    </main>
    <!-- Offcanvas menu -->
    <div
      class="offcanvas offcanvas-end w-75"
      tabindex="-1"
      id="offcanvasMenu"
      aria-labelledby="offcanvasMenuLabel"
    >
      <div class="offcanvas-header">
        <h4>List of Songs</h4>
        <button
          type="button"
          class="btn-close text-reset"
          data-bs-dismiss="offcanvas"
          aria-label="Close"
        ></button>
      </div>
      <div class="offcanvas-body">
        <ul id="offcanvasArtistSongList" class="list-group"></ul>
      </div>
    </div>
    <!-- Các biểu tượng cố định ở dưới cùng trên điện thoại -->
    <div class="icon-bar d-lg-none bg-primary px-5 py-2">
      <!-- Audio Player -->
      <audio id="mobileAudioPlayer"></audio>
      <a href="#" class="icon-phone" onclick="toggleAudioMobile()">
        <i class="fa-solid fa-play" id="playIconMobile"></i>
      </a>
      <a href="#" class="icon-phone">
        <i class="fa-solid fa-microphone-lines"></i>
      </a>
      <a href="#" class="icon-phone">
        <i class="fa-solid fa-guitar"></i>
      </a>
      <a href="#" class="icon-phone">
        <i class="fa-solid fa-drum"></i>
      </a>
      <a href="#" class="icon-phone">
        <i class="fa-solid fa-file-audio"></i>
      </a>
      <a href="#" class="icon-phone">
        <i class="fa-solid fa-keyboard"></i>
      </a>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      let songs = [];
      let currentIndex = 0;
      let selectedIndex = -1; // Variable to track selected suggestion
      let audio = document.getElementById("audioPlayer");
      let playIcon = document.getElementById("playIcon");
      let mobileAudio = document.getElementById("mobileAudioPlayer");
      let playIconMobile = document.getElementById("playIconMobile");
      async function loadSongs() {
        try {
          const response = await fetch("data.json");
          if (!response.ok) throw new Error("Không thể tải dữ liệu");
          songs = await response.json();
          document.getElementById("totalSongs").textContent = songs.length;
          document.getElementById("totalSongsDisplay").textContent =
            songs.length;
          displayArtistsAndSongs();
          displaySong();
        } catch (error) {
          console.error("Lỗi tải bài hát:", error);
        }
      }
      function displayArtistsAndSongs() {
        let artists = [...new Set(songs.map((song) => song.artist))];
        const renderArtistSongList = (elementId, hideSongs = false) => {
          let artistSongList = document.getElementById(elementId);
          artistSongList.innerHTML = artists
            .map((artist) => {
              let artistSongs = songs.filter((song) => song.artist === artist);
              let songItems = artistSongs
                .map(
                  (song) =>
                    `<li class='list-group-item ps-4' onclick="displaySongByTitle('${song.title}')">${song.title}</li>`
                )
                .join("");
              return `
          <li class='list-group-item fw-bold d-flex justify-content-between' onclick="toggleSongs('${artist}')">
            ${artist} <span class='badge bg-primary'>${
                artistSongs.length
              }</span>
          </li>
          <ul class='list-unstyled song-list ${
            hideSongs ? "" : ""
          }' id='songs-${artist}'>
            ${songItems}
          </ul>
        `;
            })
            .join("");
        };
        renderArtistSongList("artistSongList", true); // Danh sách chính
        renderArtistSongList("offcanvasArtistSongList"); // Offcanvas
      }
      function toggleSongs(artist) {
        document.querySelectorAll(".song-list").forEach((list) => {
          list.id === `songs-${artist}`
            ? list.classList.toggle("show") // Mở/đóng danh sách được chọn
            : list.classList.remove("show"); // Thu gọn các danh sách khác
        });
      }
      function displaySongByTitle(title) {
        let song = songs.find((song) => song.title === title);
        if (!song) return;
        currentIndex = songs.indexOf(song);
        displaySong();
      }
      function displaySong() {
        if (songs.length === 0) return;
        const song = songs[currentIndex];
        document.getElementById("songTitle").textContent = song.title;
        document.getElementById("songArtist").textContent = song.artist;
        document.getElementById("songLyrics").innerHTML = song.lyrics;
        document.getElementById("songNumber").textContent = song.number;
        document.getElementById("songRating").textContent = song.rating;
        document.getElementById("songYear").textContent = song.year;
        const songLink = document.getElementById("songLink");
        songLink.innerHTML = `<a href="${song.link}" target="_blank">${song.link}</a>`;
        document.getElementById("songDescription").textContent =
          song.description;
        document.getElementById("audioPlayer").src = song.official;
        document.getElementById("mobileAudioPlayer").src = song.official;
      }
      function searchSong(event) {
        let input = event.target.value.toLowerCase();
        let suggestionsList = document.getElementById("suggestionsList");
        suggestionsList.innerHTML = "";
        if (input) {
          let filteredSongs = songs.filter((song) =>
            song.title.toLowerCase().includes(input)
          );

          filteredSongs.forEach((song) => {
            let listItem = document.createElement("li");
            listItem.textContent = song.title;
            listItem.onclick = () => displaySongByTitle(song.title);
            suggestionsList.appendChild(listItem);
          });

          suggestionsList.style.display = "block";
        } else {
          suggestionsList.style.display = "none";
        }
      }
      function handleKeyPress(event) {
        let suggestionsList = document.getElementById("suggestionsList");
        let items = suggestionsList.getElementsByTagName("li");

        if (event.key === "ArrowDown") {
          selectedIndex = Math.min(items.length - 1, selectedIndex + 1);
        } else if (event.key === "ArrowUp") {
          selectedIndex = Math.max(0, selectedIndex - 1);
        } else if (event.key === "Enter" && selectedIndex !== -1) {
          items[selectedIndex].click();
        }

        for (let i = 0; i < items.length; i++) {
          items[i].classList.toggle("selected", i === selectedIndex);
        }
      }
      document
        .getElementById("searchInput")
        .addEventListener("keydown", handleKeyPress);

      loadSongs();
      function toggleAudio() {
        if (!audio || !playIcon) return;
        if (audio.paused) {
          audio.play().catch((err) => console.error(err));
          playIcon.classList.remove("fa-play");
          playIcon.classList.add("fa-pause");
        } else {
          audio.pause();
          playIcon.classList.remove("fa-pause");
          playIcon.classList.add("fa-play");
        }
      }
      // Khi audio kết thúc, tự động chuyển icon về "play"
      audio.addEventListener("ended", () => {
        playIcon.classList.remove("fa-pause");
        playIcon.classList.add("fa-play");
      });
      // Hàm cho điện thoại
      function toggleAudioMobile() {
        if (mobileAudio.paused) {
          mobileAudio
            .play()
            .catch((err) => console.error("Lỗi phát nhạc:", err));
          playIconMobile.classList.remove("fa-play");
          playIconMobile.classList.add("fa-pause");
        } else {
          mobileAudio.pause();
          playIconMobile.classList.remove("fa-pause");
          playIconMobile.classList.add("fa-play");
        }
      }
      // Khi nhạc kết thúc, đổi lại icon thành "play"
      mobileAudio.addEventListener("ended", () => {
        playIconMobile.classList.remove("fa-pause");
        playIconMobile.classList.add("fa-play");
      });
      // Hàm phát bài ngẫu nhiên
      function playRandomSong() {
        if (songs.length === 0) return;
        let randomIndex;
        do {
          randomIndex = Math.floor(Math.random() * songs.length);
        } while (randomIndex === currentIndex);
        currentIndex = randomIndex;
        displaySong();
        audio.currentTime = 0; // Reset thời gian bài hát về 0
        mobileAudio.currentTime = 0;
        audio.play().catch((err) => console.error(err));
        mobileAudio.play().catch((err) => console.error("Lỗi phát nhạc:", err));
        playIcon.classList.remove("fa-play");
        playIcon.classList.add("fa-pause");
        playIconMobile.classList.remove("fa-play");
        playIconMobile.classList.add("fa-pause");
      }
      // Sự kiện khi bài hát kết thúc -> phát bài ngẫu nhiên
      audio.addEventListener("ended", playRandomSong);
      mobileAudio.addEventListener("ended", playRandomSong);
    </script>
  </body>
</html>
